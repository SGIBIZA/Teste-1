<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Indicadores N3 - Filtro por Mês e Ano</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f2f2f2;
  }

  h2 {
    margin-bottom: 5px;
  }

  select {
    padding: 8px;
    margin-right: 10px;
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    display: none; /* tabela só aparece depois do filtro */
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    background: white;
  }

  th {
    background: #333;
    color: white;
  }
</style>
</head>
<body>

<h2>Filtro de Indicadores N3</h2>

<label>Mês:</label>
<select id="filtroMes"></select>

<label>Ano:</label>
<select id="filtroAno"></select>

<button onclick="filtrar()">Filtrar</button>

<table id="tabelaResultado">
  <thead id="cabecalho"></thead>
  <tbody id="corpoTabela"></tbody>
</table>

<script>
// Caminho do CSV direto do GitHub
const CSV_URL = "https://raw.githubusercontent.com/SGIBIZA/Teste-1/main/base_n3.csv";

// Variáveis globais
let dadosCSV = [];
let cabecalhos = [];

document.addEventListener("DOMContentLoaded", () => {
  carregarCSV();
});

// -----------------------------
// 1) Carregar CSV do GitHub
// -----------------------------
function carregarCSV() {
  fetch(CSV_URL)
    .then(resp => resp.text())
    .then(texto => {
      processarCSV(texto);
      preencherFiltros();
    })
    .catch(err => console.error("Erro ao carregar CSV:", err));
}

// -----------------------------
// 2) Processar CSV
// -----------------------------
function processarCSV(texto) {
  const linhas = texto.split("\n").map(l => l.trim()).filter(l => l);

  // Remove BOM e divide corretamente o cabeçalho
cabecalhos = linhas[0]
    .replace(/^\uFEFF/, '') // remove caractere BOM
    .split(";");

  linhas.shift(); // remove a linha do cabeçalho

  dadosCSV = linhas.map(linha => {
    const colunas = linha.split(";");
    const item = {};
    cabecalhos.forEach((c, i) => {
      item[c] = colunas[i] || "";
    });
    return item;
  });
}

// -----------------------------
// 3) Criar filtros de Mês e Ano
// -----------------------------
function preencherFiltros() {
  const filtroMes = document.getElementById("filtroMes");
  const filtroAno = document.getElementById("filtroAno");

  let meses = new Set();
  let anos = new Set();

  dadosCSV.forEach(item => {
    meses.add(item["Mês texto"]);
    anos.add(item["Ano"]);
  });

  filtroMes.innerHTML = "<option value=''>Selecione</option>";
  filtroAno.innerHTML = "<option value=''>Selecione</option>";

  meses.forEach(m => filtroMes.innerHTML += `<option value="${m}">${m}</option>`);
  anos.forEach(a => filtroAno.innerHTML += `<option value="${a}">${a}</option>`);
}

// -----------------------------
// 4) Filtrar e montar a tabela
// -----------------------------
function filtrar() {
  const mes = document.getElementById("filtroMes").value;
  const ano = document.getElementById("filtroAno").value;

  const tabela = document.getElementById("tabelaResultado");
  const cabeca = document.getElementById("cabecalho");
  const corpo = document.getElementById("corpoTabela");

  if (!mes || !ano) {
    alert("Selecione Mês e Ano para filtrar.");
    return;
  }

  const filtrados = dadosCSV.filter(item =>
    item["Mês texto"] === mes && item["Ano"] === ano
  );

  // Cabeçalho
  cabeca.innerHTML = "<tr>" + cabecalhos.map(c => `<th>${c}</th>`).join("") + "</tr>";

  // Corpo
  corpo.innerHTML = "";
  filtrados.forEach(item => {
    const linha = "<tr>" + cabecalhos.map(c => `<td>${item[c]}</td>`).join("") + "</tr>";
    corpo.innerHTML += linha;
  });

  tabela.style.display = "table";
}
</script>

</body>
</html>